<h3 class="" id="产出目录"><a name="产出目录" class="anchor" href="#产出目录"><span class="doc-link"></span></a>产出目录</h3><p>FIS 根据目录规范默认设置了文件的产出路径：</p>
<pre><code class="lang-bash">└── config
│    └── modulename-map.json    静态资源表
├── template
│    ├──home
│    │   └── page
│    │         └── index.tpl      page级模板文件
│    │   └── widget
│    │         └── section
│    │           └── section.tpl   widget模板文件
├── static
│    └── home
│    │   ├── pkg
│    │   │   ├── demo.css  打包css文件
│    │   │   └── demo.js   打包js文件
│    │   ├── index
│    │   │   ├── index.css  page级css文件
│    │   │   └── index.js   page级js文件
│    │   └── widget             widget组件目录
│    │       └── section
│    │               └── section.css
├── plugin
├── test
</code></pre>
<p>用户根据产出后的目录，只需要将 <strong>config、template、static、plugin</strong> 目录上传至联调机器进行项目联调。</p>
<h3 class="" id="上传配置"><a name="上传配置" class="anchor" href="#上传配置"><span class="doc-link"></span></a>上传配置</h3><p>用户通过配置 <strong>deploy节点</strong> 进行文件上传，fis支持使用post请求向http服务器发送文件，服务器端可以使用php、java等后端逻辑进行接收，<a href="https://github.com/fis-dev/fis-command-release">fis-command-release</a>插件中提供了一个这样的 <a href="https://github.com/fis-dev/fis-command-release/blob/master/tools/receiver.php">php版示例</a>，用户可以直接部署此文件于接收端服务器上。</p>
<blockquote>
<p>注意： receiver.php放到测试机后，请在浏览器中直接访问该文件，保证可以访问。
可以访问的情况下，页面会显示 I&#39;m ready for that, you know. </p>
</blockquote>
<p>根据产出目录以及联调机器，进行上传配置：</p>
<h4 class=""><a name="上传到1个测试机" class="anchor" href="#上传到1个测试机"><span class="doc-link"></span></a>上传到1个测试机</h4><pre><code class="lang-javascript">//上传到一个 remote测试机
fis.config.set(&#39;deploy&#39;, {
    //使用fis release --dest static来使用这个配置
    remote: [{
        //如果配置了receiver，fis会把文件逐个post到接收端上
        receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
        //从产出的结果的static目录下找文件
        from : &#39;/static&#39;,
        //上传目录从static下一级开始不包括static目录
        subOnly : true,
        //保存到远端机器的/home/fis/www/static目录下
        //这个参数会跟随post请求一起发送
        to : &#39;/home/fis/www/&#39;,
        //某些后缀的文件不进行上传
        exclude : /.*\.(?:svn|cvs|tar|rar|psd).*/
    },
    {
        //如果配置了receiver，fis会把文件逐个post到接收端上
        receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
        //从产出的结果的config目录下找文件
        from : &#39;/config&#39;,
        //保存到远端机器的/home/fis/www/config目录下
        //这个参数会跟随post请求一起发送
        to : &#39;/home/fis/www/&#39;,
        //某些后缀的文件不进行上传
        exclude : /.*\.(?:svn|cvs|tar|rar|psd).*/
    },
    {
        //如果配置了receiver，fis会把文件逐个post到接收端上
        receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
        //从产出的结果的template目录下找文件
        from : &#39;/config&#39;,
        //保存到远端机器的/home/fis/www/template目录下
        //这个参数会跟随post请求一起发送
        to : &#39;/home/fis/www/&#39;,
        //某些后缀的文件不进行上传
        exclude : /.*\.(?:svn|cvs|tar|rar|psd).*/
    },
    {
        //如果配置了receiver，fis会把文件逐个post到接收端上
        receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
        //从产出的结果的plugin目录下找文件
        from : &#39;/plugin&#39;,
        //保存到远端机器的/home/fis/www/plugin目录下
        //这个参数会跟随post请求一起发送
        to : &#39;/home/fis/www/&#39;,
        //某些后缀的文件不进行上传
        exclude : /.*\.(?:svn|cvs|tar|rar|psd).*/
    }]
});
</code></pre>
<h4 class=""><a name="上传到多个测试机" class="anchor" href="#上传到多个测试机"><span class="doc-link"></span></a>上传到多个测试机</h4><pre><code class="lang-javascript">//上传到remote，local，remote2三台机器
//fis-conf.js
fis.config.set(&#39;deploy&#39;, {
    //使用fis release --dest remote来使用这个配置
    remote : {
        //如果配置了receiver，fis会把文件逐个post到接收端上
        receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
        //从产出的结果的static目录下找文件
        from : &#39;/static&#39;,
        //保存到远端机器的/home/fis/www/static目录下
        //这个参数会跟随post请求一起发送
        to : &#39;/home/fis/www/&#39;,
        //通配或正则过滤文件，表示只上传所有的js文件
        include : &#39;**.js&#39;,
        //widget目录下的那些文件就不要发布了
        exclude : /\/widget\//i,
        //支持对文件进行字符串替换
        replace : {
            from : &#39;http://www.online.com&#39;,
            to : &#39;http://www.offline.com&#39;
        }
    },
    //名字随便取的，没有特殊含义
    local : {
        //from参数省略，表示从发布后的根目录开始上传
        //发布到当前项目的上一级的output目录中
        to : &#39;../output&#39;
    },
    //也可以是一个数组
    remote2 : [
        {
            //将static目录上传到/home/fis/www/webroot下
            //上传文件路径为/home/fis/www/webroot/static/xxxx
            receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
            from : &#39;/static&#39;,
            to : &#39;/home/fis/www/webroot&#39;
        },
        {
            //将template目录内的文件（不包括template一级）
            //上传到/home/fis/www/tpl下
            //上传文件路径为/home/fis/www/tpl/xxxx
            receiver : &#39;http://www.example.com/path/to/receiver.php&#39;,
            //from支持正则
            from : &#39;/template&#39;,
            to : &#39;/home/fis/www/tpl&#39;,
            //subOnly仅上传
            subOnly : true
        }
    ]
});
</code></pre>
<h4 class=""><a name="小贴士" class="anchor" href="#小贴士"><span class="doc-link"></span></a>小贴士</h4><ul>
<li><p><strong>--dest参数</strong> 支持使用逗号（,）分割多个发布配置，比如上面的例子，我们可以使用fis release --dest <strong>remote,plugin</strong> 命令在一次编译中同时发布多个目标。</p>
</li>
<li><p><code>subOnly参数</code>
默认上传from整个目录到测试机。添加subOnly参数仅上传from目录下文件。</p>
</li>
<li><p>replace替换多个字符串
需要replace替换多个字符串，可以使用正则的方式。例如：</p>
</li>
</ul>
<pre><code class="lang-javascript">replace : {
    from : /www\.a\.com|www\.b\.com/,
    to : function(m){
        if(m === &#39;www.a.com&#39;) return &#39;www.x.com&#39;;
        if(m === &#39;www.b.com&#39;) return &#39;www.y.com&#39;;
    }
}
</code></pre>
<h3 class="" id="上传常见问题"><a name="上传常见问题" class="anchor" href="#上传常见问题"><span class="doc-link"></span></a>上传常见问题</h3><ol>
<li><p><code>上传到一半突然中断,怎么办？</code></p>
<p> A: 请关闭测试机的服务器的防火墙，然后重新上传。至于服务器防火墙怎么关闭，不同服务器不一样，所以还是查文档或者google一下吧</p>
</li>
</ol>
