<h1 class="page-header"><a name="%E5%9B%BD%E9%99%85%E5%8C%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" class="anchor" href="#%E5%9B%BD%E9%99%85%E5%8C%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="doc-link"></span></a>国际化解决方案</h1><blockquote>
<p>国际化解决方案适应于国际化多语言支持的解决方案.</p>
</blockquote>
<ul>
<li>解决当语言增多时出现的文件成倍增长的问题</li>
<li>支持动态加载，运行时分析</li>
<li>解决本地编译效率低下、国际化目录规范复杂开发成本高等问题</li>
</ul>
<h3 class="" id="背景"><a name="%E8%83%8C%E6%99%AF" class="anchor" href="#%E8%83%8C%E6%99%AF"><span class="doc-link"></span></a>背景</h3><blockquote>
<p>国际化是指产品、应用或者内容的设计和开发可以使得不同语言、文化、地区的目标受众容易接受和实现本地化这个单词一般被缩写成 <strong>i18n</strong> </p>
</blockquote>
<p>国际化过程由如下基本的必要属性：</p>
<ul>
<li><p>设计和开发方式必须要能够容易的实现本地化和通用部署，包括使用 unicode 字符，确保对老的字符编码做了处理等等</p>
</li>
<li><p>提供一些只有在某些情况下才会使用的本地化特性。比如在 HTML 的 DTD 中支持双向的文本展示特性，或者标示出语言，或者在 CSS 中提供支持文字垂直方向展示等等</p>
</li>
<li><p>能够支持一些本地区域的语言和文化展现，如加入一些预定义的本地化数据或者从当地图书馆导出的用户属性，比如时间和日期的格式化展现，数字格式化，排序方式，用户名展示方式等等</p>
</li>
<li><p>从源码中区分本地化的元素和内容，比如本地化备选展现方式可以通过用户在界面上选择后再独立展现</p>
</li>
</ul>
<h3 class="" id="产品国际化的基本流程"><a name="%E4%BA%A7%E5%93%81%E5%9B%BD%E9%99%85%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B" class="anchor" href="#%E4%BA%A7%E5%93%81%E5%9B%BD%E9%99%85%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="doc-link"></span></a>产品国际化的基本流程</h3><ul>
<li>产品调研和确定目标市场</li>
<li>给出产品需要的功能需求文档</li>
<li>研发人员调研目标市场的本地化特性，评审需求文档</li>
<li>设计、开发</li>
<li>联调、测试，翻译语言</li>
<li>效果确认，语言确认</li>
<li>上线，效果确认，语言确认</li>
<li>前端开发调研点</li>
</ul>
<h3 class="" id="前端开发调研点"><a name="%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%B0%83%E7%A0%94%E7%82%B9" class="anchor" href="#%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%B0%83%E7%A0%94%E7%82%B9"><span class="doc-link"></span></a>前端开发调研点</h3><h4 class=""><a name="%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7" class="anchor" href="#%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7"><span class="doc-link"></span></a>语言特性</h4><ul>
<li>是否有单复数</li>
<li>字符的字节数</li>
<li>人称属性，比如他它她</li>
<li>性别属性，某些动词会因为性别属性不一样而表现不一样</li>
<li>语言展示的方向：LTR,RTL,VERTICAL</li>
</ul>
<h4 class=""><a name="%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F" class="anchor" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F"><span class="doc-link"></span></a>时间日期</h4><ul>
<li>时间的显示格式</li>
<li>日期的显示格式</li>
<li>是否有本土化的日期显示方式（如中文： 2012 年 12 月 30 日，泰语佛历显示等）</li>
<li>时区标示符，参考这里</li>
</ul>
<h4 class=""><a name="%E5%85%B6%E5%AE%83%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%86%85%E5%AE%B9" class="anchor" href="#%E5%85%B6%E5%AE%83%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%86%85%E5%AE%B9"><span class="doc-link"></span></a>其它格式化内容</h4><ul>
<li>数字格式化显示</li>
<li>货币符号</li>
<li>字符行高，字体大小</li>
</ul>
<h4 class=""><a name="%E6%9C%AC%E5%9C%B0%E4%BC%98%E5%8C%96%E7%89%B9%E6%80%A7" class="anchor" href="#%E6%9C%AC%E5%9C%B0%E4%BC%98%E5%8C%96%E7%89%B9%E6%80%A7"><span class="doc-link"></span></a>本地优化特性</h4><ul>
<li>虚拟键盘支持（阿语）</li>
<li>输入法支持（越南语有输入法的支持）</li>
<li>RTL 语言的自动识别</li>
</ul>
<h3 class="" id="FIS 国际化方案"><a name="FIS%20%E5%9B%BD%E9%99%85%E5%8C%96%E6%96%B9%E6%A1%88" class="anchor" href="#FIS%20%E5%9B%BD%E9%99%85%E5%8C%96%E6%96%B9%E6%A1%88"><span class="doc-link"></span></a>FIS 国际化方案</h3><ul>
<li>自动抽取所有的词条</li>
<li>css RTL 自动转换</li>
<li>运行时展示不同语言</li>
</ul>
<p>根据 gettext 的思路，一份代码在不同语言环境下展示不同语言。</p>
<h4 class=""><a name="%E4%BD%BF%E7%94%A8" class="anchor" href="#%E4%BD%BF%E7%94%A8"><span class="doc-link"></span></a>使用</h4><ol>
<li>下载 <a href="http://git.baidu.com/fis-dev/fis-i18n-demo/repository/archive">demo</a></li>
<li>编译发布项目<ul>
<li>fisp release -r common</li>
<li>fisp release -r i18n</li>
</ul>
</li>
<li>预览 <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a></li>
</ol>
<h4 class=""><a name="%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91" class="anchor" href="#%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91"><span class="doc-link"></span></a>如何开发</h4><p>按照上面说的使用方法，已经在本地模拟一个国际化项目。修改测试数据 <code>i18n</code> 字段，为 en_US、ja_JP 或其他分别看看效果。</p>
<pre><code class="hljs lang-php"><span class="php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-variable">$fis_data</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'i18n'</span> =&gt; <span class="hljs-string">'en_US'</span>
);
<span class="hljs-preprocessor">?&gt;</span></span>
</code></pre>
<p>进入模块 i18n，详细了解一下目录结构；</p>
<pre><code class="hljs lang-bash">└── i18n
    ├── fis-conf<span class="hljs-class">.js</span>
    ├── lang #语言目录
    │   ├── en_US<span class="hljs-class">.po</span>
    │   └── ja_JP<span class="hljs-class">.po</span>
    ├── page
    ├── server<span class="hljs-class">.conf</span>
    ├── static
    ├── test
    └── widget
</code></pre>
<p>当这个模块 release 以后得到如下结果;</p>
<pre><code class="hljs lang-bash">.
├── config
│   ├── i18n-map.json
│   └── lang
│       ├── i18n.en_US.json
│       └── i18n.ja_JP.json
├── server-conf
│   └── i18n.conf
├── <span class="hljs-keyword">static</span>
│   └── i18n
│       ├── <span class="hljs-keyword">mod</span>.js
│       └── widget
├── <span class="hljs-keyword">template</span>
│   └── i18n
│       ├── page
│       └── widget
└── test
    └── i18n
        └── page
</code></pre>
<p>可以看到 config/lang 目录下是一些 JSON 翻译文件。翻译文件格式为;</p>
<pre><code class="hljs lang-json">{
    "<span class="hljs-attribute">原文</span>": <span class="hljs-value"><span class="hljs-string">"译文"</span></span>,
    "<span class="hljs-attribute">原文 1</span>": <span class="hljs-value"><span class="hljs-string">"译文 1"</span>
</span>}
</code></pre>
<p>这样当运行时调用了翻译函数，翻译函数读取对应的翻译文件展示译文。</p>
<h5 class=""><a name="%E7%BF%BB%E8%AF%91%E5%87%BD%E6%95%B0" class="anchor" href="#%E7%BF%BB%E8%AF%91%E5%87%BD%E6%95%B0"><span class="doc-link"></span></a>翻译函数</h5><ul>
<li>JS 中的语言</li>
<li>Smarty 模板中的语言</li>
</ul>
<p>js 中的语言：</p>
<pre><code class="hljs lang-javascript"><span class="hljs-keyword">var</span> str = __(<span class="hljs-string">'中文'</span>);
</code></pre>
<p>Smarty 模板中的语言：</p>
<pre><code class="hljs lang-html">{<span class="hljs-preprocessor">%</span><span class="hljs-string">'中文'</span>|gettext<span class="hljs-preprocessor">%</span>}
</code></pre>
<p>综述，开发过程；</p>
<ol>
<li>功能开发完成后，通过 <code>fisp xgettext</code> 抽取所有的词条，产出 <code>&lt;namespace&gt;.en_US.po</code> 等语言文件</li>
<li>开发人员完善 <code>po</code> 文件</li>
<li>编译项目 <code>fisp release -r project</code></li>
<li>fis 在编译过程中，分析 <code>po</code> 文件，生成 <code>&lt;namespace&gt;.en_US.json</code> 语言翻译文件 <code>key=&gt;value</code></li>
<li>运行时执行 <code>{%&#39;xxxx&#39;|gettext%}</code> 函数时，根据语言类型，读取对应的翻译文字并展示</li>
</ol>
<h4 class=""><a name="%E6%9B%B4%E5%A4%9A%E8%B5%84%E6%96%99" class="anchor" href="#%E6%9B%B4%E5%A4%9A%E8%B5%84%E6%96%99"><span class="doc-link"></span></a>更多资料</h4><p>更多国际化资料 [<a href="http://fe.baidu.com/doc/i18n/">http://fe.baidu.com/doc/i18n/</a>]</p>
